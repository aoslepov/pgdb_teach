- name: install packages
  ansible.builtin.apt:
    update_cache: yes
    pkg:
     - "unzip"

#pgbouncer_exporter | create dir
- name: create dirs
  ansible.builtin.file:
    path: "{{item}}"
    state: directory
  loop:
   - "/usr/local/sbin/pg_bouncer_exporter"

- name: pgbouncer_exporter templating service
  template:
    src: "pgbouncer_exporter.service"
    dest: "/etc/systemd/system/pgbouncer_exporter.service"

- name: pgbouncer exporter download
  ansible.builtin.unarchive:
    src: pgbouncer_exporter.tar.gz
    dest: /usr/local/sbin/pg_bouncer_exporter/
 
#перегружаем конфигурацию systemd и ставим режим enabled
- name: pgbouncer_exporter enable 
  systemd: name="pgbouncer_exporter" daemon_reload=yes enabled=yes

# запускаем сервис
- name: pgbouncer_exporter start
  ansible.builtin.service:
    name: pgbouncer_exporter
    state: restarted
