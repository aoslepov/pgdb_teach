### Установка и настройка PostgteSQL в контейнере Docker

> Cоздать ВМ с Ubuntu 20.04/22.04 или развернуть докер любым удобным способом.
> Поставить на нем Docker Engine.
> Cделать каталог /var/lib/postgres.

```
 sudo apt-get update && sudo apt-get install ca-certificates curl gnupg 
 sudo install -m 0755 -d /etc/apt/keyrings && curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg && sudo chmod a+r /etc/apt/keyrings/docker.gpg
 echo "deb [arch="$(dpkg --print-architecture)" signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu "$(. /etc/os-release && echo "$VERSION_CODENAME")" stable" |   sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
 sudo apt-get update && apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin docker-compose
 mkdir -p /var/lib/postgres
 ```


docker pull postgres:15.2
dock


> Развернуть контейнер с PostgreSQL 15 смонтировав в него /var/lib/postgresql. 
> Развернуть контейнер с клиентом postgres.
> Подключится из контейнера с клиентом к контейнеру с сервером и сделать таблицу с парой строк


создаём docker-compose.yml
```

-- Cоздаём docker-compose.yml

services:
  postgres:
    container_name: pg-server
    hostname: pg-server
    image: postgres:15.2
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: testuser
    volumes:
       - /var/lib/postgresql:/var/lib/postgres/data
    ports:
      - "5432:5432"
    restart: unless-stopped
    networks:
      - 'pg-net'

networks:
  pg-net:
    driver: bridge
```



```
--- запускем контейнер
docker-compose up -d
Creating network "docker_pg-net" with driver "bridge" -- будет создана сеть docker_pg-net


-- подключаемся к контейнеру pg-server в сети docker_pg-net под юзером admin
sudo docker run -it --rm --network docker_pg-net --name pg-client postgres:15 psql -h pg-server -U admin
Password for user admin:

-- создаём тестовую бд, боваляем строки

admin=# create database pg_tech;
CREATE DATABASE
admin=# \c pg_tech
You are now connected to database "pg_tech" as user "admin".
pg_tech=# create table test (id int, tmp text);
CREATE TABLE
pg_tech=# insert into test (id,tmp) values (1,'test1'),(2,'test2');
INSERT 0 2
pg_tech=# select * from test;
 id |  tmp
----+-------
  1 | test1
  2 | test2
(2 rows)
```




• подключится к контейнеру с сервером с ноутбука/компьютера извне инстансов GCP/ЯО/места установки докера
• удалить контейнер с сервером
• создать его заново
• подключится снова из контейнера с клиентом к контейнеру с сервером
• проверить, что данные остались на месте
• оставляйте в ЛК ДЗ комментарии что и как вы делали и как боролись с проблемами

